{
  "type": "minecraft-java",
  "display": "Minecraft: Java Edition",
  "data": {
    "eula": {
      "type": "boolean",
      "value": false,
      "display": "EULA Agreement (true/false)",
      "desc": "Do you (or the server owner) agree to the <a href='https://account.mojang.com/documents/minecraft_eula'>Minecraft EULA?</a>",
      "required": true,
      "userEdit": true
    },
    "forgebuild": {
      "type": "string",
      "value": "",
      "display": "Forge Version",
      "desc": "Version of Forge to install (may be located <a href='http://files.minecraftforge.net/#Downloads'>here</a>",
      "required": false,
      "userEdit": true
    },
    "ip": {
      "type": "string",
      "value": "0.0.0.0",
      "display": "IP",
      "desc": "What IP to bind the server to",
      "required": true,
      "userEdit": false
    },
    "javaversion": {
      "type": "string",
      "value": "17",
      "display": "Java Version",
      "desc": "Version of Java to use",
      "required": true,
      "userEdit": true
    },
    "jvmArgs": {
      "type": "string",
      "value": "-Dterminal.jline=false -Dterminal.ansi=true -Dlog4j2.formatMsgNoLookups=true",
      "display": "JVM Arguments",
      "desc": "Extra JVM arguments to pass",
      "required": false,
      "userEdit": false
    },
    "magmatag": {
      "type": "string",
      "value": "68e21495",
      "display": "Tag",
      "desc": "The alphanumeric commit ID for the build (See https://git.magmafoundation.org/magmafoundation/Magma-1-18-x/-/releases for the commit ID's for each release))",
      "required": false,
      "userEdit": true
    },
    "memory": {
      "type": "integer",
      "value": 1024,
      "display": "Memory (MB)",
      "desc": "How much memory in MB to allocate to the Java Heap",
      "required": true,
      "userEdit": false
    },
    "modlauncher": {
      "type": "string",
      "value": "",
      "display": "Mod/Plugin Launcher",
      "desc": "What mod or plugin launcher should be installed with Minecraft",
      "required": false,
      "userEdit": true,
      "options": [
        {
          "value": "",
          "display": "None/Vanilla"
        },
        {
          "value": "fabric",
          "display": "Fabric"
        },
        {
          "value": "forge",
          "display": "MinecraftForge"
        },
        {
          "value": "magma",
          "display": "Magma"
        },
        {
          "value": "mohist",
          "display": "Mohist"
        },
        {
          "value": "paper",
          "display": "Paper"
        },
        {
          "value": "pufferfish",
          "display": "Pufferfish"
        },
        {
          "value": "purpur",
          "display": "Purpur"
        },
        {
          "value": "quilt",
          "display": "Quilt"
        },
        {
          "value": "spigot",
          "display": "Spigot"
        },
        {
          "value": "ftb",
          "display": "Feed The Beast Modpack"
        },
        {
          "value": "curseforge",
          "display": "CurseForge Modpack"
        }
      ]
    },
    "mohistversion": {
      "type": "string",
      "value": "latest",
      "display": "Mohist Version",
      "desc": "Mohist version to install (may be located <a href='https://mohistmc.com/download/' target='_blank'>here</a>).",
      "required": false,
      "userEdit": true
    },
    "motd": {
      "type": "string",
      "value": "A Minecraft Server\\n\\u00A79 hosted on PufferPanel",
      "display": "MOTD message of the day",
      "desc": "This is the message that is displayed in the server list of the client, below the name. The MOTD does support <a href='https://minecraft.gamepedia.com/Formatting_codes' target='_blank'>color and formatting codes</a>.",
      "required": true,
      "userEdit": true
    },
    "paperbuild": {
      "type": "string",
      "value": "96",
      "display": "build",
      "desc": "Build of Paper to install (<a href='https://papermc.io/downloads'>Paper version build</a>). Must be specified as a build number, e.g. 484",
      "required": false,
      "userEdit": true
    },
    "port": {
      "type": "integer",
      "value": 25565,
      "display": "Port",
      "desc": "What port to bind the server to",
      "required": true,
      "userEdit": false
    },
    "version": {
      "type": "string",
      "value": "latest",
      "display": "Version",
      "desc": "Version of Minecraft you wish to install (not all software may respect this value",
      "required": true,
      "userEdit": true
    }
  },
  "groups": [
    {
      "display": "General",
      "description": "General settings for all servers",
      "variables": [
        "eula",
        "memory",
        "ip",
        "port",
        "motd",
        "version",
        "javaversion",
        "modlauncher"
      ],
      "order": 1
    },
    {
      "if": "modlauncher == 'forge'",
      "display": "Forge",
      "description": "Settings if using MinecraftForge",
      "variables": [
        "forgebuild"
      ],
      "order": 2
    },
    {
      "if": "modlauncher == 'magma'",
      "display": "Magma",
      "description": "Settings specific if using Magma",
      "variables": [
        "magmatag"
      ],
      "order": 3
    },
    {
      "if": "modlauncher == 'mohist'",
      "display": "Mohist",
      "description": "Settings specific if using Mohist",
      "variables": [
        "mohistversion"
      ],
      "order": 4
    },
    {
      "if": "modlauncher == 'paper'",
      "display": "Paper",
      "description": "Settings specific if using Paper",
      "variables": [
        "paperbuild"
      ],
      "order": 5
    }
  ],
  "install": [
    {
      "if": "javaversion != ''",
      "type": "javadl",
      "version": "${javaversion}"
    },
    {
      "if": "modlauncher == ''",
      "type": "mojangdl",
      "version": "${version}",
      "target": "server.jar"
    },
    {
      "if": "modlauncher == 'fabric'",
      "type": "fabricdl"
    },
    {
      "if": "modlauncher == 'fabric' && env == 'host'",
      "type": "command",
      "commands": [
        "java${javaversion} -jar fabric-installer.jar server -mcversion ${version} -downloadMinecraft -noprofile"
      ]
    },
    {
      "if": "modlauncher == 'fabric' && env != 'host'",
      "type": "command",
      "commands": [
        "java -jar fabric-installer.jar server -mcversion ${version} -downloadMinecraft -noprofile"
      ]
    },
    {
      "if": "modlauncher == 'forge'",
      "type": "forgedl",
      "target": "installer.jar",
      "version": "${forgebuild}",
      "minecraftVersion": "${version}"
    },
    {
      "if": "modlauncher == 'forge' && env == 'host'",
      "type": "command",
      "commands": [
        "java${javaversion} -jar installer.jar --installServer"
      ]
    },
    {
      "if": "modlauncher == 'forge' && env != 'host'",
      "type": "command",
      "commands": [
        "java -jar installer.jar --installServer"
      ]
    },
    {
      "if": "modlauncher == 'forge' && file_exists('forge-' + forgebuild + '-shim.jar')",
      "type": "move",
      "source": "forge-${forgebuild}-shim.jar",
      "target": "server.jar"
    },
    {
      "if": "modlauncher == 'magma'",
      "type": "download",
      "files": [
        "https://api.magmafoundation.org/api/v2/${minecraftversion}/latest/${tag}/download"
      ]
    },
    {
      "if": "modlauncher == 'magma'",
      "type": "move",
      "target": "server.jar",
      "source": "Magma-*.jar"
    },
    {
      "if": "modlauncher == 'mohist'",
      "type": "download",
      "files": [
        "https://mohistmc.com/api/${mc-version}/${mohistversion}/download/"
      ]
    },
    {
      "if": "modlauncher == 'mohist'",
      "type": "move",
      "target": "server.jar",
      "source": "mohist-*-server.jar"
    },
    {
      "if": "modlauncher == 'paper'",
      "type": "download",
      "files": [
        "https://api.papermc.io/v2/projects/paper/versions/${version}/builds/${build}/downloads/paper-${version}-${paperbuild}.jar"
      ]
    },
    {
      "if": "modlauncher == 'paper'",
      "type": "move",
      "target": "paper.jar",
      "source": "paper-*.jar"
    },
    {
      "if": "modlauncher == 'quilt'",
      "type": "download",
      "files": [
        "https://maven.quiltmc.org/repository/release/org/quiltmc/quilt-installer/latest/quilt-installer-latest.jar"
      ]
    },
    {
      "if": "modlauncher == 'quilt'",
      "type": "move",
      "target": "quilt-installer.jar",
      "source": "quilt-installer-*.jar"
    },
    {
      "if": "modlauncher == 'quilt' && env == 'host'",
      "type": "command",
      "commands": [
        "java${javaversion} -jar quilt-installer.jar install server ${version} --download-server --install-dir=."
      ]
    },
    {
      "if": "modlauncher == 'quilt' && env != 'host'",
      "type": "command",
      "commands": [
        "java -jar quilt-installer.jar install server ${version} --download-server --install-dir=."
      ]
    },
    {
      "if": "modlauncher == 'quilt'",
      "type": "move",
      "target": "server.jar",
      "source": "quilt-server-launch.jar"
    },
    {
      "if": "modlauncher == 'spigot'",
      "type": "download",
      "files": [
        "https://hub.spigotmc.org/jenkins/job/BuildTools/lastSuccessfulBuild/artifact/target/BuildTools.jar"
      ]
    },
    {
      "if": "modlauncher == 'spigot' && env == 'host'",
      "type": "command",
      "commands": [
        "java${javaversion} -jar BuildTools.jar --rev ${version}"
      ]
    },
    {
      "if": "modlauncher == 'spigot' && env != 'host'",
      "type": "command",
      "commands": [
        "java -jar BuildTools.jar --rev ${version}"
      ]
    },
    {
      "if": "modlauncher == 'spigot'",
      "type": "move",
      "source": "spigot-*.jar",
      "target": "server.jar"
    },
    {
      "if": "!file_exists(\"server.properties\")",
      "type": "writefile",
      "text": "server-ip=${ip}\nserver-port=${port}\nmotd=${motd}\n",
      "target": "server.properties"
    },
    {
      "type": "writefile",
      "text": "eula=${eula}",
      "target": "eula.txt"
    }
  ],
  "run": {
    "command": [
      {
        "command": "java${javaversion} -Xmx${memory}M ${jvmArgs} @libraries/net/minecraftforge/forge/${resolvedForgeVersion}/win_args.txt nogui",
        "if": "env == 'host' && modlauncher == 'forge' && os == 'windows' && file_exists('libraries/net/minecraftforge/forge/' + resolvedForgeVersion + '/win_args.txt')"
      },
      {
        "command": "java${javaversion} -Xmx${memory}M ${jvmArgs} @libraries/net/minecraftforge/forge/${resolvedForgeVersion}/unix_args.txt nogui",
        "if": "env == 'host' && modlauncher == 'forge' && file_exists('libraries/net/minecraftforge/forge/' + resolvedForgeVersion + '/unix_args.txt')"
      },
      {
        "command": "java -Xmx${memory}M ${jvmArgs} @libraries/net/minecraftforge/forge/${resolvedForgeVersion}/win_args.txt nogui",
        "if": "env != 'host' && modlauncher == 'forge' && os == 'windows' && file_exists('libraries/net/minecraftforge/forge/' + resolvedForgeVersion + '/win_args.txt')"
      },
      {
        "command": "java -Xmx${memory}M ${jvmArgs} @libraries/net/minecraftforge/forge/${resolvedForgeVersion}/unix_args.txt nogui",
        "if": "env != 'host' && modlauncher == 'forge' && file_exists('libraries/net/minecraftforge/forge/' + resolvedForgeVersion+ '/unix_args.txt')"
      },
      {
        "command": "java${javaversion} -Xmx${memory}M ${jvmArgs} -jar fabric-server-launch.jar",
        "if": "env == 'host' && modlauncher == 'fabric'"
      },
      {
        "command": "java -Xmx${memory}M ${jvmArgs} -jar server.jar",
        "if": "env != 'host' && modlauncher == 'fabric'"
      },
      {
        "command": "java${javaversion} -Xmx${memory}M ${jvmArgs} -jar server.jar",
        "if": "env == 'host'"
      },
      {
        "command": "java -Xmx${memory}M ${jvmArgs} -jar server.jar"
      }
    ],
    "pre": [
      {
          "if": "modlauncher == 'forge'",
          "type": "resolveforgeversion",
          "minecraftVersion": "${version}",
          "version": "${forgebuild}",
          "outputVariable": "resolvedForgeVersion"
      }
    ],
    "stop": "stop",
    "stdin": {
      "type": "stdin"
    },
    "autostart": false,
    "autorecover": false,
    "autorestart": false
  },
  "environment": {
    "type": "host"
  },
  "supportedEnvironments": [
    {
      "type": "host"
    },
    {
      "type": "docker",
      "image": "eclipse-temurin:${javaversion}"
    }
  ],
  "requirements": {}
}
